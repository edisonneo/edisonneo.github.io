function removeFromArray(e){for(var o,t,r=arguments,a=r.length;a>1&&e.length;)for(o=r[--a];-1!==(t=e.indexOf(o));)e.splice(t,1);return e}function changeInputToText(e){input=e.find(".human input.response"),value=input.val(),input.replaceWith("<p class='registered'>"+value+"</p>")}function addInventory(e){inventory.indexOf(e)>-1||!(inventory.indexOf(e)>-1)&&room.objects.indexOf(e)>-1&&(inventory.push(e),removeFromArray(room.objects,e))}function removeInventory(e){return inventory.indexOf(e)>-1?void console.log("its in the array"):(console.log("nothing"),!1)}function analyzeInput(e){if(text=e.val().toLowerCase(),output=text.split(/[ ,]+/),outputlen=output.length-1,action=output[0],noun=output[outputlen],"look"==text)response=room.prompt;else if("inventory"==text)response=0==inventory.length?"Nothing in the bag.":inventory.join();else if(0==outputlen)response="Please enter more words.";else if(noun==action)response="That dosen't make sense.";else if("search around"==text)roomObj=room.objects,response=room.reactions[text].response+" Items that are found:"+room.objects.join();else if("use"==action||"take"==action||"throw"==action)switch(action){case"take":if(room.objects.length>0)for(var t=0;t<room.objects.length;t++){if(o=room.objects[t],noun==o&&room.reactions[action].applicable[noun]){response=room.reactions[action].applicable[noun].response,room=gameWorld.rooms[room.reactions[action].applicable[noun].room],addInventory(noun);break}if(room.objects.indexOf(noun)>-1){response=room.reactions[action]["default"].response+" "+noun,room=gameWorld.rooms[room.reactions[action]["default"].room],addInventory(noun);break}response="You grasp around for nothing but air."}else response="There's nothing left in the room";break;case"throw":inventory.indexOf(noun)>-1?(removeFromArray(inventory,noun),room.objects.push(noun),response=room.reactions[action].response+" "+noun,room=gameWorld.rooms[room.reactions[action].room]):response="Wait what?";break;case"use":for(var t=0;t<inventory.length;t++)if(a=inventory[t],noun==a&&room.reactions[action].applicable[noun]){if("gun"!=a||!room.guards){response=room.reactions[action].applicable[noun].response,room=gameWorld.rooms[room.reactions[action].applicable[noun].room];break}if(room.guards.length>0){delete room.guards,response=room.reactions[action].applicable[noun].response,room=gameWorld.rooms[room.reactions[action].applicable[noun].room],delete room.reactions[action].applicable.gun;break}response="Nothing happened."}else response=room.reactions[action]["default"].response,room=gameWorld.rooms[room.reactions[action]["default"].room]}else if(-1!==text.indexOf("go")){for(var t=0;t<room.accepted.length;t++)if(a=room.accepted[t],room.guards)room.guards.length>0&&(response="Can't escape! The guard is firing at you!");else if(text==a){room.reactions[text].guard&&gameWorld.rooms[room.reactions[text].room].guards?(response=room.reactions[text].guard.response,room=gameWorld.rooms[room.reactions[text].guard.room]):(correct=room.reactions[text],response=correct.response,room=gameWorld.rooms[correct.room]);break}}else response="I do not understand the words that are coming out of your mouth."}var response,currentRoom="start",room=gameWorld.rooms[currentRoom];$(".dialog .machine .text").text(room.startPrompt);var inventory=[],responseLog=[];$(document).keypress(function(e){13==e.which&&(currentDialog=$(".dialog:last"),newDialog=currentDialog.clone(),currentDialog.addClass("registered"),"end"==room.name?alert("THE END. Refresh to try again."):analyzeInput(currentDialog.find("input.response")),"Can't escape! The guard is firing at you!"!==response?responseLog=[]:responseLog.push(response),3==responseLog.length&&(alert("You are dead. Please refresh to start again"),room=gameWorld.rooms.end),changeInputToText(currentDialog),newDialog.find(".machine p").text(response),newDialog.appendTo(".console"),$("input.response").val("").focus(),console.log(responseLog),console.log(room.name),console.log(inventory),console.log(room.objects),room.guards&&console.log(room.guards))});
